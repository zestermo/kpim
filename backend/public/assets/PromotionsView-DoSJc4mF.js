import{n as E,r as k,o as H,a as Q,q as g,c as l,b as t,e as v,A as U,h as c,i as B,j as N,k as J,F as _,s as y,g as f,w as K,T as O,m as n,t as i,x as T}from"./index-67zp9BDn.js";const W={class:"space-y-6"},X={class:"flex items-center justify-between flex-wrap gap-4"},Z=["disabled"],tt={key:0,class:"game-panel p-4 border-yellow-500/50"},et={class:"text-yellow-400 flex items-center gap-2"},st={key:1,class:"game-panel p-6 border-kpop-gold-500/50"},ot={class:"space-y-3"},nt={class:"font-bold"},lt={class:"text-sm text-gray-400"},at={class:"text-sm text-kpop-gold-400 mt-1"},it={key:0,class:"ml-2 text-red-400 font-bold"},rt=["onClick","disabled"],dt={key:2,class:"game-panel p-6"},ct={class:"space-y-3"},ut={class:"flex items-center gap-4"},pt={class:"text-2xl"},vt={class:"font-bold"},mt={class:"text-sm text-gray-400"},gt={class:"text-right"},ft={class:"text-kpop-pink-400 font-mono text-lg"},bt={key:3,class:"game-panel p-6"},_t={class:"space-y-2"},yt={class:"flex items-center gap-3"},xt={class:"text-gray-400"},kt={key:0,class:"text-red-400"},ht={class:"text-gray-400"},wt={key:4,class:"game-panel p-12 text-center"},St={class:"game-panel p-6 max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto"},Pt={class:"mb-6"},Ct={class:"grid grid-cols-2 gap-2"},It=["onClick"],Tt={class:"font-bold"},$t={class:"mb-6"},jt={key:0,class:"space-y-2"},Gt=["onClick"],Lt={class:"font-bold"},Mt={class:"text-sm text-gray-400"},Vt={key:1,class:"text-gray-400 text-center py-4"},Bt={class:"mb-6"},Nt={class:"space-y-2"},Rt=["onClick","disabled"],At={class:"flex items-center justify-between"},Ft={class:"font-bold"},Dt={class:"text-sm text-gray-400"},Yt={class:"text-right"},qt={class:"font-bold text-kpop-gold-400"},zt={class:"flex gap-3"},Et=["disabled"],Ht={key:0,class:"flex items-center justify-center gap-2"},Qt={key:1},Kt={__name:"PromotionsView",setup(Ut){const a=E(),x=k(!1),u=k(null),m=k(null),b=k(null),S=k([]);let P=null;H(async()=>{await Promise.all([a.fetchPromotions(),a.fetchGroups(),a.fetchSongs(),R()]),P=setInterval(()=>{a.fetchPromotions()},5e3)}),Q(()=>{P&&clearInterval(P)});async function R(){S.value=await a.fetchAvailablePromotions()}const $=g(()=>a.promotions.filter(o=>o.is_active)),j=g(()=>a.promotions.filter(o=>o.is_ready)),G=g(()=>a.promotions.filter(o=>o.is_completed).slice(0,10)),h=g(()=>a.completedSongs),C=g(()=>u.value?h.value.filter(o=>o.group_id===u.value):[]),L=g(()=>a.groups.length>0&&h.value.length>0),A=g(()=>{var e;if(!u.value||!m.value||!b.value)return!1;const o=S.value.find(p=>p.type===b.value);return o&&((e=a.player)==null?void 0:e.money)>=o.cost});function M(){var o,e;if(u.value=((o=a.groups[0])==null?void 0:o.id)||null,m.value=null,b.value=null,x.value=!0,u.value){const p=h.value.filter(s=>s.group_id===u.value);m.value=((e=p[0])==null?void 0:e.id)||null}}function F(){var o;m.value=((o=C.value[0])==null?void 0:o.id)||null}async function D(){(await a.startPromotion(u.value,m.value,b.value)).success&&(x.value=!1)}async function Y(o){await a.completePromotion(o)}function q(o){const e=new Date,p=new Date(o),s=Math.max(0,p-e),r=Math.floor(s/6e4),d=Math.floor(s%6e4/1e3);return`${r}:${d.toString().padStart(2,"0")}`}function w(o){return{social_post:"ðŸ“± Social Post",press_interview:"ðŸ“° Press Interview",tv_appearance:"ðŸ“º TV Appearance",showcase:"ðŸŽ¤ Showcase",fansign:"âœï¸ Fansign"}[o]||o}function V(o){return a.groups.find(e=>e.id===o)}function I(o){return a.songs.find(e=>e.id===o)}return(o,e)=>{const p=J("router-link");return n(),l("div",W,[t("div",X,[e[3]||(e[3]=t("div",null,[t("h1",{class:"text-2xl font-bold"},"Promotions"),t("p",{class:"text-gray-400"},"Run promotions to gain fans and money")],-1)),t("button",{onClick:M,class:"btn-primary flex items-center gap-2",disabled:!L.value},[...e[2]||(e[2]=[t("span",null,"ðŸ“¢",-1),c(" Start Promotion ",-1)])],8,Z)]),h.value.length===0?(n(),l("div",tt,[t("p",et,[e[5]||(e[5]=t("span",null,"âš ï¸",-1)),e[6]||(e[6]=c(" You need a completed song to run promotions. ",-1)),B(p,{to:"/music",class:"underline"},{default:N(()=>[...e[4]||(e[4]=[c("Produce music first",-1)])]),_:1})])])):v("",!0),j.value.length>0?(n(),l("div",st,[e[7]||(e[7]=t("h2",{class:"text-lg font-bold mb-4 flex items-center gap-2"},[t("span",{class:"animate-bounce"},"ðŸŽ"),c(" Ready to Collect! ")],-1)),t("div",ot,[(n(!0),l(_,null,y(j.value,s=>{var r,d;return n(),l("div",{key:s.id,class:"flex items-center justify-between p-4 bg-kpop-gold-500/10 rounded-xl border border-kpop-gold-500/30"},[t("div",null,[t("p",nt,i(w(s.type)),1),t("p",lt,i((r=V(s.group_id))==null?void 0:r.name)+" - "+i((d=I(s.song_id))==null?void 0:d.title),1),t("p",at,[c(" +"+i(s.fan_reward.toLocaleString())+" fans, +$"+i(s.money_reward.toLocaleString())+" ",1),s.went_viral?(n(),l("span",it,"ðŸ”¥ VIRAL!")):v("",!0)])]),t("button",{onClick:z=>Y(s.id),class:"btn-gold",disabled:f(a).loading}," Collect! ðŸŽ‰ ",8,rt)])}),128))])])):v("",!0),$.value.length>0?(n(),l("div",dt,[e[9]||(e[9]=t("h2",{class:"text-lg font-bold mb-4 flex items-center gap-2"},[t("span",{class:"animate-pulse"},"â³"),c(" In Progress ")],-1)),t("div",ct,[(n(!0),l(_,null,y($.value,s=>{var r,d;return n(),l("div",{key:s.id,class:"flex items-center justify-between p-4 bg-gray-800/50 rounded-xl"},[t("div",ut,[t("div",pt,i(w(s.type).split(" ")[0]),1),t("div",null,[t("p",vt,i(w(s.type).split(" ").slice(1).join(" ")),1),t("p",mt,i((r=V(s.group_id))==null?void 0:r.name)+" - "+i((d=I(s.song_id))==null?void 0:d.title),1)])]),t("div",gt,[t("div",ft,i(q(s.ends_at)),1),e[8]||(e[8]=t("div",{class:"text-xs text-gray-400"},"remaining",-1))])])}),128))])])):v("",!0),G.value.length>0?(n(),l("div",bt,[e[10]||(e[10]=t("h2",{class:"text-lg font-bold mb-4 flex items-center gap-2"},[t("span",null,"ðŸ“‹"),c(" Recent Activity ")],-1)),t("div",_t,[(n(!0),l(_,null,y(G.value,s=>{var r;return n(),l("div",{key:s.id,class:"flex items-center justify-between p-3 bg-gray-800/30 rounded-lg text-sm"},[t("div",yt,[t("span",null,i(w(s.type).split(" ")[0]),1),t("span",xt,i((r=I(s.song_id))==null?void 0:r.title),1),s.went_viral?(n(),l("span",kt,"ðŸ”¥")):v("",!0)]),t("div",ht," +"+i(s.fan_reward.toLocaleString())+" fans ",1)])}),128))])])):v("",!0),f(a).promotions.length===0&&L.value?(n(),l("div",wt,[e[11]||(e[11]=t("div",{class:"text-6xl mb-4"},"ðŸ“¢",-1)),e[12]||(e[12]=t("h2",{class:"text-xl font-bold mb-2"},"No Promotions Yet",-1)),e[13]||(e[13]=t("p",{class:"text-gray-400 mb-6"},"Run your first promotion to gain fans!",-1)),t("button",{onClick:M,class:"btn-primary"}," Start Your First Promotion ")])):v("",!0),(n(),U(O,{to:"body"},[x.value?(n(),l("div",{key:0,class:"modal-backdrop",onClick:e[1]||(e[1]=K(s=>x.value=!1,["self"]))},[t("div",St,[e[20]||(e[20]=t("h2",{class:"text-2xl font-bold mb-6 text-center"},"ðŸ“¢ Start Promotion",-1)),t("div",Pt,[e[14]||(e[14]=t("label",{class:"block text-sm text-gray-400 mb-2"},"Select Group",-1)),t("div",Ct,[(n(!0),l(_,null,y(f(a).groups,s=>(n(),l("button",{key:s.id,onClick:r=>{u.value=s.id,F()},class:T(["p-3 rounded-xl border-2 transition-all text-left",u.value===s.id?"border-kpop-pink-500 bg-kpop-pink-500/10":"border-gray-600 hover:border-gray-500"])},[t("div",Tt,i(s.name),1)],10,It))),128))])]),t("div",$t,[e[17]||(e[17]=t("label",{class:"block text-sm text-gray-400 mb-2"},"Select Song",-1)),C.value.length>0?(n(),l("div",jt,[(n(!0),l(_,null,y(C.value,s=>(n(),l("button",{key:s.id,onClick:r=>m.value=s.id,class:T(["w-full p-3 rounded-xl border-2 transition-all text-left",m.value===s.id?"border-kpop-pink-500 bg-kpop-pink-500/10":"border-gray-600 hover:border-gray-500"])},[t("div",Lt,i(s.title),1),t("div",Mt," Quality: "+i(s.quality)+" | Hype: "+i(s.hype),1)],10,Gt))),128))])):(n(),l("p",Vt,[e[16]||(e[16]=c(" No songs available for this group. ",-1)),B(p,{to:"/music",class:"text-kpop-pink-400 underline"},{default:N(()=>[...e[15]||(e[15]=[c("Produce a song",-1)])]),_:1})]))]),t("div",Bt,[e[18]||(e[18]=t("label",{class:"block text-sm text-gray-400 mb-2"},"Promotion Type",-1)),t("div",Nt,[(n(!0),l(_,null,y(S.value,s=>{var r,d;return n(),l("button",{key:s.type,onClick:z=>b.value=s.type,class:T(["w-full p-4 rounded-xl border-2 transition-all",[b.value===s.type?"border-kpop-pink-500 bg-kpop-pink-500/10":"border-gray-600 hover:border-gray-500",((r=f(a).player)==null?void 0:r.money)<s.cost?"opacity-50":""]]),disabled:((d=f(a).player)==null?void 0:d.money)<s.cost},[t("div",At,[t("div",null,[t("div",Ft,i(s.name),1),t("div",Dt," ~"+i(s.base_fans)+" fans | "+i(s.duration_minutes)+" min ",1)]),t("div",Yt,[t("div",qt," ðŸ’° "+i(s.cost.toLocaleString()),1)])])],10,Rt)}),128))])]),t("div",zt,[t("button",{onClick:e[0]||(e[0]=s=>x.value=!1),class:"btn-secondary flex-1"}," Cancel "),t("button",{onClick:D,class:"btn-primary flex-1",disabled:!A.value||f(a).loading},[f(a).loading?(n(),l("span",Ht,[...e[19]||(e[19]=[t("span",{class:"spinner"},null,-1),c(" Starting... ",-1)])])):(n(),l("span",Qt,"Start Promotion! ðŸš€"))],8,Et)])])])):v("",!0)]))])}}};export{Kt as default};
